<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}" itemscope itemtype="https://schema.org/WebPage">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  {{/* Primary Meta Tags */}}
  <title>{{ block "title" . }}{{ with .Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{ end }}</title>
  <meta name="title" content="{{ block "meta-title" . }}{{ with .Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{ end }}">
  <meta name="description" content="{{ block "meta-description" . }}{{ with .Description }}{{ . }}{{ else }}{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}{{ end }}">
  <meta name="keywords" content="{{ delimit (default .Site.Params.keywords .Params.keywords) ", " }}">
  <meta name="author" content="{{ .Site.Params.author }}">
  <meta name="robots" content="{{ with .Params.robots }}{{ . }}{{ else }}index, follow{{ end }}">

  {{/* Canonical URL */}}
  <link rel="canonical" href="{{ .Permalink }}">

  {{/* Language and Region */}}
  <meta name="language" content="English">
  <meta name="geo.region" content="{{ with .Params.region }}{{ . }}{{ end }}">
  <meta name="geo.placename" content="{{ with .Params.placename }}{{ . }}{{ end }}">

  {{/* Open Graph / Facebook */}}
  <meta property="og:type" content="{{ block "og-type" . }}{{ if .IsHome }}website{{ else if .IsPage }}article{{ else }}website{{ end }}{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:title" content="{{ block "og-title" . }}{{ .Title }}{{ end }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}">
  <meta property="og:image" content="{{ block "og-image" . }}{{ with .Params.image }}{{ . | absURL }}{{ else }}{{ .Site.Params.ogImage | absURL }}{{ end }}{{ end }}">
  <meta property="og:image:alt" content="{{ .Title }}">
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:locale" content="en_US">
  {{ if .IsPage }}
  <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
  <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
  {{ end }}

  {{/* Twitter */}}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{{ .Permalink }}">
  <meta name="twitter:title" content="{{ .Title }}">
  <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}">
  <meta name="twitter:image" content="{{ with .Params.image }}{{ . | absURL }}{{ else }}{{ .Site.Params.ogImage | absURL }}{{ end }}">
  {{ with .Site.Params.twitterHandle }}<meta name="twitter:site" content="{{ . }}">{{ end }}

  {{/* Favicons */}}
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#2563eb">
  <meta name="msapplication-TileColor" content="#2563eb">

  {{/* Fonts - Google Fonts with display swap for performance */}}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  {{/* Main Stylesheet */}}
  {{ $css := resources.Get "css/main.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $css.Permalink }}" integrity="{{ $css.Data.Integrity }}">

  {{/* RSS Feed */}}
  {{ range .AlternativeOutputFormats -}}
  {{ printf `<link rel="%s" type="%s" href="%s" title="%s">` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end }}

  {{/* Preload critical resources */}}
  <link rel="preload" href="{{ $css.Permalink }}" as="style">

  {{/* Schema.org JSON-LD */}}
  {{ block "schema" . }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": "{{ .Site.BaseURL }}#organization",
        "name": "{{ .Site.Params.organizationName }}",
        "url": "{{ .Site.BaseURL }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ .Site.Params.organizationLogo | absURL }}"
        },
        "sameAs": []
      },
      {
        "@type": "WebSite",
        "@id": "{{ .Site.BaseURL }}#website",
        "url": "{{ .Site.BaseURL }}",
        "name": "{{ .Site.Title }}",
        "description": "{{ .Site.Params.description }}",
        "publisher": {
          "@id": "{{ .Site.BaseURL }}#organization"
        },
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "{{ .Site.BaseURL }}search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@type": "WebPage",
        "@id": "{{ .Permalink }}#webpage",
        "url": "{{ .Permalink }}",
        "name": "{{ .Title }}",
        "description": "{{ with .Description }}{{ . }}{{ else }}{{ .Params.description }}{{ end }}",
        "isPartOf": {
          "@id": "{{ .Site.BaseURL }}#website"
        },
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        "breadcrumb": {
          "@id": "{{ .Permalink }}#breadcrumb"
        }
      }
    ]
  }
  </script>
  {{ end }}

  {{/* FAQ Schema for AEO - if page has FAQs */}}
  {{ with .Params.faqs }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {{ range $i, $faq := . }}{{ if $i }},{{ end }}
      {
        "@type": "Question",
        "name": "{{ $faq.question }}",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "{{ $faq.answer }}"
        }
      }
      {{ end }}
    ]
  }
  </script>
  {{ end }}

  {{/* HowTo Schema for guides */}}
  {{ with .Params.howto }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "{{ .name }}",
    "description": "{{ .description }}",
    "step": [
      {{ range $i, $step := .steps }}{{ if $i }},{{ end }}
      {
        "@type": "HowToStep",
        "name": "{{ $step.name }}",
        "text": "{{ $step.text }}"
      }
      {{ end }}
    ]
  }
  </script>
  {{ end }}

  {{/* Custom head content */}}
  {{ block "head" . }}{{ end }}
</head>
<body class="{{ block "body-class" . }}{{ end }}">
  {{/* Skip to main content for accessibility */}}
  <a href="#main-content" class="skip-link">Skip to main content</a>

  {{/* Header */}}
  {{ partial "header.html" . }}

  {{/* Main Content */}}
  <main id="main-content" role="main">
    {{ block "main" . }}{{ end }}
  </main>

  {{/* Footer */}}
  {{ partial "footer.html" . }}

  {{/* JavaScript */}}
  <script>
    // Mobile navigation toggle
    document.addEventListener('DOMContentLoaded', function() {
      const navToggle = document.querySelector('.nav-toggle');
      const nav = document.querySelector('.nav');

      if (navToggle && nav) {
        navToggle.addEventListener('click', function() {
          nav.classList.toggle('is-open');
          navToggle.setAttribute('aria-expanded', nav.classList.contains('is-open'));
        });
      }
    });
  </script>

  {{ block "scripts" . }}{{ end }}
</body>
</html>
